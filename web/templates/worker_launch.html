<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <title>Worker Launch</title>
    <style>
        body {
            background-color: #15171a;
            color: #c7c7c7;
        }

        pre {
            font-size: 1em !important;
        }

        .rounded-2 {
            border-radius: .5rem !important;
            background-color: #212529 !important;
            -webkit-box-shadow: 0px 1px 0px 0px #000;
            box-shadow: 0px 1px 0px 0px #000;
            border: 0 !important;
            margin: 10px;
            padding: 10px;
            padding-top: 20px;
        }

        .rounded-3 {
            border-radius: .5rem !important;
            background-color: #212529 !important;
            -webkit-box-shadow: 0px 1px 0px 0px #000;
            box-shadow: 0px 1px 0px 0px #000;
            border: 0 !important;
            margin: 10px;
            padding: 10px;
            padding-top: 20px;
            overflow-y: auto;
        }
    </style>
    <script>
        function volumeAdd() {
            var cur_vols = $('#volumes').children().length
            var new_vol_row=`<div class="row mb-3 volume">
                    <div class="col-md">
                        <label for="volume_host_path0" class="form-label">Host Path</label>
                        <input type="text" class="form-control" placeholder="/mnt/disk1" 
                            name="volume_host_path" id="volume_host_path0" aria-label="volume_host_path0">
                    </div>
                    <div class="col-sm">
                        <label for="volume_container_path0" class="form-label">Container Path</label>
                        <input type="text" class="form-control" placeholder="/plots" aria-label="volume_container_path0"
                            name="volume_container_path" id="volume_container_path0">
                    </div>
                    <div class="col-auto">
                        <label for="volume_type0" class="form-label">Used for:</label>
                        <select class="form-select" id="volume_type0" name="volume_type" aria-label="volume_type0">
                            <option value="plots" selected>Final Plots</option>
                            <option value="plotting">Plotting Temp</option>
                            <option value="other">Other</option>
                          </select>
                    </div>
                </div>`;
            new_vol_row = new_vol_row.replaceAll('0', cur_vols)
            $('#volumes').append(new_vol_row);
        }
        function volumeRemove() {
            $('.volume').last().remove()
        }
        function togglePlottingKeysVisibility() {
            if (document.getElementById('mode-plotter').checked) {
                $('#plotting_keys_row').show()
            } else {
                $('#plotting_keys_row').hide()
            }
        }
        function toggleFarmerAddressVisibility() {
            if (document.getElementById('mode-harvester').checked) {
                $('#farmer_address_row').show()
            } else {
                $('#farmer_address_row').hide()
            }
        }
        function getRadioButtonValue(name) {
            var radios = document.getElementsByName(name);
            for (var i = 0, length = radios.length; i < length; i++) {
                if (radios[i].checked) {
                    return radios[i].value
                }
            }
        }
        function updateDocker() {
            console.log(getRadioButtonValue('os'))
            if (getRadioButtonValue('os') == 'windows') {
                line_end = ' `\n';
            } else {
                line_end = ' \\\n';
            }
            cmd =  'docker run' + line_end;
            cmd += '    -d -t -h' + line_end;
            cmd += '    ghcr.io/guydavis/machinaris' + line_end;
            $('#run').html(cmd); 
        }
        $(document).ready(function () {
            $('#plotting_keys_row').hide()
            //$('#farmer_address_row').hide() 
            $('#farmer_address').val(location.hostname)
        });
    </script>
</head>

<body>
    <form>
        <div class="rounded-2">
            <h2>Machinaris Worker - Launch Config</h2>
            <p></p>
            <div class="row mb-3">
                <div class="col">
                    <label for="hostname" class="form-label">Worker Hostname</label>
                    <input type="text" class="form-control" placeholder="worker1" aria-label="hostname" onkeypress="updateDocker()">
                </div>
                <div class="col">
                    <label for="ip_addr" class="form-label">Worker IP Address (Optional)</label>
                    <input type="text" class="form-control" placeholder="192.168.1.100" aria-label="ip_addr" onkeypress="updateDocker()">
                </div>
            </div>
            <div class="row mb-3">
                <div class="col offset">
                    <label for="inputState" class="form-label">Operating System</label>
                    <div class="row">
                        <div class="col">
                            <input class="form-check-input" type="radio" name="os" id="os-linux" value="linux" checked onclick="updateDocker()">
                            <label class="form-check-label" for="os-linux">
                                Linux
                            </label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="radio" name="os" id="os-windows" value="windows" onclick="updateDocker()">
                            <label class="form-check-label" for="os-windows">
                                Windows
                            </label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="radio" name="os" id="os-macintosh" value="macintosh" onclick="updateDocker()">
                            <label class="form-check-label" for="os-macintosh">
                                Macintosh
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col offset">
                    <label for="inputState" class="form-label">Machinaris Mode</label>
                    <div class="row">
                        <div class="col">
                            <input class="form-check-input" type="checkbox" checked name="mode" id="mode-harvester"
                                onclick="toggleFarmerAddressVisibility();updateDocker();">
                            <label class="form-check-label" for="mode-harvester">
                                Harvester
                            </label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="checkbox" name="mode" id="mode-plotter"
                                onclick="togglePlottingKeysVisibility();updateDocker();">
                            <label class="form-check-label" for="mode-plotter">
                                Plotter
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-3" id="farmer_address_row">
                <div class="col">
                    <label for="farmer_address" class="form-label">Farmer Address</label>
                    <input type="text" class="form-control" aria-label="farmer_address" id="farmer_address" onkeypress="updateDocker()">
                </div>
                <div class="col">
                    <label for="farmer_port" class="form-label">Farmer Port</label>
                    <input type="text" class="form-control" aria-label="farmer_port" value="8447" id="farmer_port" onkeypress="updateDocker()">
                </div>
            </div>
            <div class="row mb-3" id="plotting_keys_row">
                <div class="col">
                    <label for="farmer_pk" class="form-label">Farmer Public Key</label>
                    <input type="text" class="form-control" aria-label="farmer_pk" value="{{farmer_pk}}" id="farmer_pk" onclick="updateDocker()">
                </div>
                <div class="col">
                    <label for="pool_pk" class="form-label">Pool Public Key</label>
                    <input type="text" class="form-control" aria-label="pool_pk" value="{{pool_pk}}" id="pool_pk" onkeypress="updateDocker()">
                </div>
                <div class="col">
                    <label for="pool_contract_address" class="form-label">Pool Contract Address</label>
                    <input type="text" class="form-control" aria-label="pool_contract_address"
                        value="{{pool_contract_address}}" id="pool_contract_address" onkeypress="updateDocker()">
                </div>
                <div class="col offset">
                    <label for="inputState" class="form-label">Plot on Startup</label>
                    <div class="row">
                        <div class="col">
                            <input class="form-check-input" type="radio" name="auto_plot" id="auto-plot-true" onclick="updateDocker()">
                            <label class="form-check-label" for="auto-plot-true">
                                True
                            </label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="radio" name="auto_plot" id="auto-plot-false" checked onclick="updateDocker()">
                            <label class="form-check-label" for="auto-plot-false">
                                False
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col">
                    <label for="appdata" class="form-label">Application Data</label>
                    <input type="text" class="form-control" value='"%USERPROFILE%"/.machinaris' aria-label="appdata" onkeypress="updateDocker()">
                </div>
                <div class="col">
                    <label for="timezone" class="form-label">Timezone</label>
                    {% include 'views/timezones_select.html' %}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col offset">
                    <label for="inputState" class="form-label">Blockchains to Farm</label>
                    <div class="row">
                        <div class="col">
                            <input class="form-check-input" type="checkbox" disabled checked name="blockchains"
                                id="blockchain-chia" onclick="updateDocker()">
                            <label class="form-check-label" for="blockchain-chia" onclick="updateDocker()">
                                Chia (required)
                            </label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="checkbox" name="blockchains" id="blockchain-flax" onclick="updateDocker()">
                            <label class="form-check-label" for="blockchain-flax">
                                Flax (optional)
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col offset">
                </div>
            </div>
            <div class="row mb-3" id="volumes">
                <h4>Volume Mounts</h4>
                <div class="row mb-3 volume">
                    <div class="col-md">
                        <label for="volume_host_path1" class="form-label">Host Path</label>
                        <input type="text" class="form-control" placeholder="/mnt/disk1" onkeypress="updateDocker()"
                            name="volume_host_path" id="volume_host_path1" aria-label="volume_host_path1">
                    </div>
                    <div class="col-sm">
                        <label for="volume_container_path1" class="form-label">Container Path</label>
                        <input type="text" class="form-control" value="/plots" aria-label="volume_container_path1"
                            name="volume_container_path" id="volume_container_path1" onkeypress="updateDocker()">
                    </div>
                    <div class="col-auto">
                        <label for="volume_type1" class="form-label">Used for:</label>
                        <select class="form-select" id="volume_type1" name="volume_type" aria-label="volume_type1" onchange="updateDocker()">
                            <option value="plots" selected>Final Plots</option>
                            <option value="plotting">Plotting Temp</option>
                            <option value="other">Other</option>
                          </select>
                    </div>
                </div>
                <div class="row mb-3 volume">
                    <div class="col-md">
                        <label for="volume_host_path2" class="form-label">Host Path</label>
                        <input type="text" class="form-control" placeholder="/mnt/temp2" onkeypress="updateDocker()"
                            name="volume_host_path" id="volume_host_path2" aria-label="volume_host_path2">
                    </div>
                    <div class="col-sm">
                        <label for="volume_container_path2" class="form-label">Container Path</label>
                        <input type="text" class="form-control" value="/plotting" aria-label="volume_container_path2"
                            name="volume_container_path" id="volume_container_path2" onkeypress="updateDocker()">
                    </div>
                    <div class="col-auto">
                        <label for="volume_type2" class="form-label">Used for:</label>
                        <select class="form-select" id="volume_type2" name="volume_type" aria-label="volume_type2" onchange="updateDocker()">
                            <option value="plots">Final Plots</option>
                            <option value="plotting" selected>Plotting Temp</option>
                            <option value="other">Other</option>
                          </select>
                    </div>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col">
                </div>
                <div class="col-auto">
                    <a href="#volumes" onclick="volumeAdd();" title="Add New Volume"><i
                            class="fs-4 bi-plus text-white text-right"></i></a><a href="#volumes"
                        onclick="volumeRemove();" title="Remove Last Volume"><i
                            class="fs-4 bi-dash text-white text-right"></i></a>
                </div>
            </div>
        </div>
    </form>
    <div class="rounded-3 small" id="docker_run">
        <a style="float:right" href="#" title="Copy">
            <i class="fs-4 bi-clipboard text-white"></i>
        </a>
        <h2>Docker Run</h2>
        <pre id="run"></pre>
    </div>
    <div class="rounded-3 small" id="docker_compose">
        <a style="float:right;" href="#" title="Copy">
            <i class="fs-4 bi-clipboard text-white"></i>
        </a>
        <h2>Docker Compose</h2>
        <pre id="compose">
TODO
        </pre>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>
</body>

</html>